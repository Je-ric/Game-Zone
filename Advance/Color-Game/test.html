<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carnival Color Cubes Deluxe</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 3D Cube Styles */
        .scene {
            perspective: 600px;
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        
        .cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1.5s;
        }
        
        .cube-face {
            position: absolute;
            width: 120px;
            height: 120px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        /* Cube face positions */
        .front  { transform: rotateY(0deg) translateZ(60px); }
        .right  { transform: rotateY(90deg) translateZ(60px); }
        .back   { transform: rotateY(180deg) translateZ(60px); }
        .left   { transform: rotateY(-90deg) translateZ(60px); }
        .top    { transform: rotateX(90deg) translateZ(60px); }
        .bottom { transform: rotateX(-90deg) translateZ(60px); }
        
        /* Animations */
        @keyframes spin {
            0% { transform: rotateX(0) rotateY(0); }
            100% { transform: rotateX(360deg) rotateY(720deg); }
        }
        
        .spinning {
            animation: spin 1.5s ease-out;
        }
        
        /* Color selection styles */
        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
        }
        
        .color-option.selected {
            border-color: white;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }
        
        .color-option .hex-code {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 10px;
            padding: 2px 0;
            transition: all 0.3s;
            opacity: 0;
        }
        
        .color-option:hover .hex-code {
            bottom: 0;
            opacity: 1;
        }
        
        /* Confetti animation for wins */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            animation: confetti-fall 3s ease-in-out forwards;
            z-index: 100;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 100px)) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Betting chip styles */
        .betting-chip {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px dashed white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .betting-chip:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        
        .betting-chip.selected {
            border-style: solid;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        
        /* Balance change animation */
        .balance-change {
            animation: balance-pop 0.5s ease-out;
        }
        
        @keyframes balance-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Game mode tabs */
        .mode-tab {
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .mode-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(to right, #f59e0b, #ef4444);
            transition: width 0.3s;
        }
        
        .mode-tab.active::after {
            width: 100%;
        }
        
        .mode-tab:hover::after {
            width: 100%;
        }
        
        /* Neon text effect */
        .neon-text {
            text-shadow: 
                0 0 5px rgba(255, 255, 255, 0.8),
                0 0 10px rgba(255, 255, 255, 0.5),
                0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        /* Achievements badges */
        .achievement-badge {
            position: relative;
            transition: all 0.3s;
        }
        
        .achievement-badge:hover {
            transform: scale(1.1);
        }
        
        .achievement-badge .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .achievement-badge:hover .tooltip {
            opacity: 1;
            visibility: visible;
            bottom: 110%;
        }
        
        /* Pulse animation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Floating animation */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Streak counter */
        .streak-counter {
            transition: all 0.3s;
        }
        
        .streak-counter.highlight {
            transform: scale(1.2);
            color: #fcd34d;
        }
        
        /* Level progress bar */
        .level-progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .level-progress-fill {
            height: 100%;
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            border-radius: 5px;
            transition: width 0.5s;
        }
        
        /* Sparkle effect */
        .sparkle {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: white;
            opacity: 0;
            pointer-events: none;
        }
        
        @keyframes sparkle {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-b from-purple-900 via-indigo-900 to-blue-900 text-white min-h-screen">
    <!-- Floating Bubbles Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="absolute top-10 left-1/4 w-32 h-32 rounded-full bg-pink-500 opacity-10 float"></div>
        <div class="absolute top-1/3 left-3/4 w-48 h-48 rounded-full bg-yellow-500 opacity-10 float" style="animation-delay: 1s;"></div>
        <div class="absolute top-2/3 left-1/5 w-40 h-40 rounded-full bg-green-500 opacity-10 float" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/4 left-2/3 w-36 h-36 rounded-full bg-blue-500 opacity-10 float" style="animation-delay: 1.5s;"></div>
        <div class="absolute top-3/4 left-1/2 w-44 h-44 rounded-full bg-purple-500 opacity-10 float" style="animation-delay: 0.5s;"></div>
    </div>

    <div class="relative z-10 max-w-5xl mx-auto p-4">
        <!-- Header -->
        <header class="text-center py-6">
            <h1 class="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-500 mb-2 neon-text">Carnival Color Cubes</h1>
            <p class="text-xl text-yellow-200 mt-2">Place your bets and test your luck in this colorful carnival adventure!</p>
        </header>
        
        <!-- Player Info & Name Change -->
        <div class="bg-gradient-to-r from-purple-800 to-indigo-800 rounded-xl p-4 mb-6 shadow-lg">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-pink-500 to-orange-400 flex items-center justify-center text-2xl font-bold mr-4">
                        <span id="playerInitial">P</span>
                    </div>
                    <div>
                        <div class="flex items-center">
                            <h2 id="playerNameDisplay" class="text-xl font-bold mr-2">Player</h2>
                            <button id="editNameBtn" class="text-xs bg-indigo-700 hover:bg-indigo-600 px-2 py-1 rounded">
                                Edit
                            </button>
                        </div>
                        <div id="nameEditContainer" class="hidden mt-2 flex">
                            <input type="text" id="playerNameInput" class="bg-indigo-900 border border-indigo-700 rounded-l px-2 py-1 text-white" placeholder="Enter name">
                            <button id="saveNameBtn" class="bg-green-600 hover:bg-green-500 px-2 py-1 rounded-r">Save</button>
                        </div>
                        <div class="flex items-center mt-1">
                            <div class="text-xs text-gray-300 mr-2">Level <span id="playerLevel">1</span></div>
                            <div class="w-32 level-progress-bar">
                                <div id="levelProgressFill" class="level-progress-fill" style="width: 25%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Player Stats -->
                <div class="flex space-x-4">
                    <div class="bg-indigo-900 rounded-lg p-3 text-center">
                        <div class="text-xs text-gray-400">Balance</div>
                        <div id="balanceDisplay" class="text-2xl font-bold text-yellow-400">1000</div>
                    </div>
                    <div class="bg-indigo-900 rounded-lg p-3 text-center">
                        <div class="text-xs text-gray-400">Win Streak</div>
                        <div id="streakDisplay" class="text-2xl font-bold streak-counter">0</div>
                    </div>
                    <div class="bg-indigo-900 rounded-lg p-3 text-center">
                        <div class="text-xs text-gray-400">Total Wins</div>
                        <div id="winsDisplay" class="text-2xl font-bold">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Game Modes Tabs -->
        <div class="mb-6">
            <div class="flex overflow-x-auto space-x-2 bg-indigo-900/50 p-2 rounded-t-xl">
                <button class="mode-tab px-4 py-2 text-white font-medium active" data-mode="classic">
                    üé≤ Classic
                </button>
                <button class="mode-tab px-4 py-2 text-white font-medium" data-mode="streak">
                    üî• Streak Challenge
                </button>
                <button class="mode-tab px-4 py-2 text-white font-medium" data-mode="jackpot">
                    üí∞ Jackpot
                </button>
                <button class="mode-tab px-4 py-2 text-white font-medium" data-mode="hex">
                    üé® Hex Master
                </button>
            </div>
        </div>
        
        <!-- Game Container -->
        <div class="bg-gradient-to-br from-indigo-800 to-purple-900 rounded-xl shadow-2xl overflow-hidden mb-6">
            <!-- Game Controls -->
            <div class="bg-gradient-to-r from-pink-800 to-purple-800 p-4 flex flex-col md:flex-row justify-between items-center">
                <!-- Difficulty Selection -->
                <div class="mb-4 md:mb-0">
                    <span class="text-yellow-200 mr-2">Difficulty:</span>
                    <div class="inline-flex rounded-md shadow-sm" role="group">
                        <button id="easyBtn" class="difficulty-btn px-4 py-2 text-sm font-medium bg-gradient-to-r from-green-600 to-green-700 text-white rounded-l-lg hover:from-green-700 hover:to-green-800 focus:z-10 focus:ring-2 focus:ring-green-300 active">
                            Easy (3 Cubes)
                        </button>
                        <button id="mediumBtn" class="difficulty-btn px-4 py-2 text-sm font-medium bg-gradient-to-r from-yellow-600 to-yellow-700 text-white hover:from-yellow-700 hover:to-yellow-800 focus:z-10 focus:ring-2 focus:ring-yellow-300">
                            Medium (6 Cubes)
                        </button>
                        <button id="hardBtn" class="difficulty-btn px-4 py-2 text-sm font-medium bg-gradient-to-r from-red-600 to-red-700 text-white rounded-r-lg hover:from-red-700 hover:to-red-800 focus:z-10 focus:ring-2 focus:ring-red-300">
                            Hard (9 Cubes)
                        </button>
                    </div>
                </div>
                
                <!-- Game Mode Description -->
                <div id="modeDescription" class="text-center text-yellow-200 font-medium">
                    Classic Mode: Bet on colors and win based on occurrences!
                </div>
            </div>
            
            <!-- Main Game Area -->
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Left Side: Cubes and Result -->
                <div class="flex flex-col items-center">
                    <h2 class="text-2xl font-bold mb-4 text-center text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-pink-500">The Color Cubes</h2>
                    
                    <!-- Cubes Container -->
                    <div id="cubesContainer" class="grid grid-cols-3 gap-4 mb-6">
                        <!-- Cubes will be generated here -->
                    </div>
                    
                    <!-- Result Message -->
                    <div id="resultMessage" class="text-xl font-bold h-8 mb-4 text-center"></div>
                    
                    <!-- Roll Button -->
                    <button id="rollButton" class="bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed pulse">
                        ROLL THE CUBES
                    </button>
                </div>
                
                <!-- Right Side: Betting Options -->
                <div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-pink-500">Place Your Bet</h2>
                    
                    <!-- Color Selection -->
                    <div class="mb-6">
                        <p class="text-gray-300 mb-2">Select a color:</p>
                        <div id="colorOptions" class="flex flex-wrap justify-center gap-4">
                            <!-- Color options will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Bet Amount -->
                    <div class="mb-6">
                        <p class="text-gray-300 mb-2">Bet amount:</p>
                        <div class="flex justify-center gap-3">
                            <div class="betting-chip bg-gradient-to-br from-red-500 to-red-700" data-amount="10">10</div>
                            <div class="betting-chip bg-gradient-to-br from-green-500 to-green-700" data-amount="50">50</div>
                            <div class="betting-chip bg-gradient-to-br from-blue-500 to-blue-700" data-amount="100">100</div>
                            <div class="betting-chip bg-gradient-to-br from-purple-500 to-purple-700" data-amount="500">500</div>
                        </div>
                    </div>
                    
                    <!-- Custom Bet Input -->
                    <div class="flex justify-center items-center gap-2 mb-4">
                        <input type="number" id="customBetInput" min="1" max="10000" value="10" class="w-24 px-3 py-2 bg-indigo-900 border border-indigo-700 rounded-md text-white">
                        <button id="setCustomBetBtn" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-3 py-2 rounded-md">
                            Set Bet
                        </button>
                    </div>
                    
                    <!-- Current Bet Display -->
                    <div class="bg-indigo-900/70 rounded-lg p-4 text-center mb-4">
                        <p class="text-gray-400">Current Bet</p>
                        <div class="flex justify-center items-center gap-2">
                            <div id="selectedColorDisplay" class="w-6 h-6 rounded-full bg-gray-500"></div>
                            <span id="betAmountDisplay" class="text-2xl font-bold">0</span>
                        </div>
                    </div>
                    
                    <!-- Payout Table -->
                    <div class="bg-indigo-900/70 rounded-lg p-4">
                        <h3 class="text-center font-bold mb-2 text-yellow-300">Payout Table</h3>
                        <table class="w-full text-center">
                            <thead>
                                <tr class="border-b border-indigo-700">
                                    <th class="py-2">Occurrences</th>
                                    <th class="py-2">Payout</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-indigo-800">
                                    <td class="py-1">1</td>
                                    <td class="py-1">2x bet</td>
                                </tr>
                                <tr class="border-b border-indigo-800">
                                    <td class="py-1">2</td>
                                    <td class="py-1">3x bet</td>
                                </tr>
                                <tr class="border-b border-indigo-800">
                                    <td class="py-1">3</td>
                                    <td class="py-1">5x bet</td>
                                </tr>
                                <tr class="border-b border-indigo-800">
                                    <td class="py-1">4</td>
                                    <td class="py-1">8x bet</td>
                                </tr>
                                <tr class="border-b border-indigo-800">
                                    <td class="py-1">5</td>
                                    <td class="py-1">12x bet</td>
                                </tr>
                                <tr>
                                    <td class="py-1">6+</td>
                                    <td class="py-1">20x bet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Betting History -->
            <div class="bg-indigo-900/80 p-4">
                <h3 class="text-xl font-bold mb-3 text-center text-yellow-300">Betting History</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="border-b border-indigo-700">
                                <th class="px-4 py-2 text-left">Round</th>
                                <th class="px-4 py-2 text-left">Your Bet</th>
                                <th class="px-4 py-2 text-left">Occurrences</th>
                                <th class="px-4 py-2 text-right">Outcome</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <!-- History rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Achievements Section -->
        <div class="bg-gradient-to-br from-indigo-900 to-purple-900 rounded-xl p-6 shadow-lg mb-6">
            <h2 class="text-2xl font-bold mb-4 text-center text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-pink-500">Achievements</h2>
            <div class="grid grid-cols-3 md:grid-cols-6 gap-4 justify-items-center">
                <div class="achievement-badge w-16 h-16 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center" id="achievement1">
                    <span class="text-2xl">üé≤</span>
                    <div class="tooltip">First Win: Win your first bet</div>
                </div>
                <div class="achievement-badge w-16 h-16 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center" id="achievement2">
                    <span class="text-2xl">üí∞</span>
                    <div class="tooltip">Rich: Reach 5000 balance</div>
                </div>
                <div class="achievement-badge w-16 h-16 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center" id="achievement3">
                    <span class="text-2xl">üî•</span>
                    <div class="tooltip">Hot Streak: Win 5 times in a row</div>
                </div>
                <div class="achievement-badge w-16 h-16 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center" id="achievement4">
                    <span class="text-2xl">üéØ</span>
                    <div class="tooltip">Lucky: Win with all 6 cubes showing your color</div>
                </div>
                <div class="achievement-badge w-16 h-16 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center" id="achievement5">
                    <span class="text-2xl">üèÜ</span>
                    <div class="tooltip">Champion: Win 50 total bets</div>
                </div>
                <div class="achievement-badge w-16 h-16 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center" id="achievement6">
                    <span class="text-2xl">üß†</span>
                    <div class="tooltip">Hex Master: Win in Hex Master mode</div>
                </div>
            </div>
        </div>
        
        <!-- Game Instructions -->
        <div class="bg-gradient-to-br from-indigo-900 to-purple-900 rounded-xl p-6 shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-center text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-pink-500">How to Play</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-xl font-bold mb-2 text-pink-400">Basic Rules</h3>
                    <ol class="list-decimal pl-6 space-y-2 text-gray-300">
                        <li>Choose a difficulty level: Easy (3 cubes), Medium (6 cubes), or Hard (9 cubes)</li>
                        <li>Select a color to bet on</li>
                        <li>Choose your bet amount using the betting chips or enter a custom amount</li>
                        <li>Click "ROLL THE CUBES" to start the game</li>
                        <li>Each cube has 6 sides with different colors</li>
                        <li>Your payout depends on how many times your color appears</li>
                        <li>If your color doesn't appear, you lose your bet</li>
                    </ol>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-2 text-pink-400">Game Modes</h3>
                    <ul class="list-disc pl-6 space-y-2 text-gray-300">
                        <li><span class="text-yellow-300">Classic:</span> Standard betting game with payouts based on occurrences</li>
                        <li><span class="text-yellow-300">Streak Challenge:</span> Win consecutive bets to increase your multiplier</li>
                        <li><span class="text-yellow-300">Jackpot:</span> Higher risk, higher reward with progressive jackpot</li>
                        <li><span class="text-yellow-300">Hex Master:</span> Test your color knowledge by betting on hex codes</li>
                    </ul>
                    <h3 class="text-xl font-bold mt-4 mb-2 text-pink-400">Leveling System</h3>
                    <p class="text-gray-300">Win bets to gain XP and level up! Higher levels unlock special bonuses and achievements.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const cubesContainer = document.getElementById('cubesContainer');
        const rollButton = document.getElementById('rollButton');
        const colorOptions = document.getElementById('colorOptions');
        const resultMessage = document.getElementById('resultMessage');
        const balanceDisplay = document.getElementById('balanceDisplay');
        const betAmountDisplay = document.getElementById('betAmountDisplay');
        const selectedColorDisplay = document.getElementById('selectedColorDisplay');
        const historyTableBody = document.getElementById('historyTableBody');
        const customBetInput = document.getElementById('customBetInput');
        const setCustomBetBtn = document.getElementById('setCustomBetBtn');
        const easyBtn = document.getElementById('easyBtn');
        const mediumBtn = document.getElementById('mediumBtn');
        const hardBtn = document.getElementById('hardBtn');
        const bettingChips = document.querySelectorAll('.betting-chip');
        const streakDisplay = document.getElementById('streakDisplay');
        const winsDisplay = document.getElementById('winsDisplay');
        const playerNameDisplay = document.getElementById('playerNameDisplay');
        const playerInitial = document.getElementById('playerInitial');
        const editNameBtn = document.getElementById('editNameBtn');
        const nameEditContainer = document.getElementById('nameEditContainer');
        const playerNameInput = document.getElementById('playerNameInput');
        const saveNameBtn = document.getElementById('saveNameBtn');
        const playerLevel = document.getElementById('playerLevel');
        const levelProgressFill = document.getElementById('levelProgressFill');
        const modeTabs = document.querySelectorAll('.mode-tab');
        const modeDescription = document.getElementById('modeDescription');
        
        // Game Variables
        let playerBalance = 1000;
        let currentBet = 0;
        let selectedColor = null;
        let gameInProgress = false;
        let roundNumber = 1;
        let numCubes = 3; // Default to easy
        let winStreak = 0;
        let totalWins = 0;
        let playerName = "Player";
        let playerXP = 0;
        let currentLevel = 1;
        let currentGameMode = "classic"; // Default game mode
        let achievements = {
            firstWin: false,
            rich: false,
            hotStreak: false,
            lucky: false,
            champion: false,
            hexMaster: false
        };
        
        // All possible colors with hex codes
        const allColors = [
            { name: 'Red', bgClass: 'bg-red-500', hexCode: '#EF4444' },
            { name: 'Blue', bgClass: 'bg-blue-500', hexCode: '#3B82F6' },
            { name: 'Green', bgClass: 'bg-green-500', hexCode: '#10B981' },
            { name: 'Yellow', bgClass: 'bg-yellow-500', hexCode: '#F59E0B' },
            { name: 'Purple', bgClass: 'bg-purple-500', hexCode: '#8B5CF6' },
            { name: 'Orange', bgClass: 'bg-orange-500', hexCode: '#F97316' }
        ];
        
        // Payout multipliers based on occurrences
        const payoutMultipliers = {
            1: 2,   // 1 occurrence: 2x bet
            2: 3,   // 2 occurrences: 3x bet
            3: 5,   // 3 occurrences: 5x bet
            4: 8,   // 4 occurrences: 8x bet
            5: 12,  // 5 occurrences: 12x bet
            6: 20   // 6 occurrences: 20x bet
        };
        
        // Streak mode multipliers
        const streakMultipliers = {
            0: 1,
            1: 1.2,
            2: 1.5,
            3: 2,
            4: 3,
            5: 5
        };
        
        // Cube face rotations for each color
        const cubeRotations = {
            'Red': 'rotateY(0deg)',
            'Blue': 'rotateY(180deg)',
            'Green': 'rotateY(90deg)',
            'Yellow': 'rotateY(-90deg)',
            'Purple': 'rotateX(90deg)',
            'Orange': 'rotateX(-90deg)'
        };
        
        // XP required for each level
        const levelXPRequirements = {
            1: 100,
            2: 250,
            3: 500,
            4: 1000,
            5: 2000
        };
        
        // Initialize the game
        initGame();
        
        function initGame() {
            updateBalance(playerBalance);
            setupEventListeners();
            createCubes();
            renderColorOptions();
            updatePlayerInfo();
            loadGameData();
        }
        
        function setupEventListeners() {
            // Roll button click
            rollButton.addEventListener('click', rollCubes);
            
            // Betting chip selection
            bettingChips.forEach(chip => {
                chip.addEventListener('click', function() {
                    const amount = parseInt(this.getAttribute('data-amount'));
                    setBetAmount(amount);
                    
                    // Update visual selection
                    bettingChips.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // Custom bet button
            setCustomBetBtn.addEventListener('click', function() {
                const customAmount = parseInt(customBetInput.value);
                if (customAmount > 0 && customAmount <= playerBalance) {
                    setBetAmount(customAmount);
                    
                    // Remove selection from betting chips
                    bettingChips.forEach(c => c.classList.remove('selected'));
                } else {
                    alert('Please enter a valid bet amount (1 to ' + playerBalance + ')');
                }
            });
            
            // Difficulty buttons
            easyBtn.addEventListener('click', function() {
                setDifficulty('easy');
                easyBtn.classList.add('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                mediumBtn.classList.remove('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                hardBtn.classList.remove('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                mediumBtn.classList.add('bg-gradient-to-r', 'from-yellow-600', 'to-yellow-700');
                hardBtn.classList.add('bg-gradient-to-r', 'from-red-600', 'to-red-700');
            });
            
            mediumBtn.addEventListener('click', function() {
                setDifficulty('medium');
                mediumBtn.classList.add('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                easyBtn.classList.remove('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                hardBtn.classList.remove('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                easyBtn.classList.add('bg-gradient-to-r', 'from-green-600', 'to-green-700');
                hardBtn.classList.add('bg-gradient-to-r', 'from-red-600', 'to-red-700');
            });
            
            hardBtn.addEventListener('click', function() {
                setDifficulty('hard');
                hardBtn.classList.add('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                easyBtn.classList.remove('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                mediumBtn.classList.remove('active', 'bg-gradient-to-r', 'from-green-600', 'to-green-700');
                easyBtn.classList.add('bg-gradient-to-r', 'from-green-600', 'to-green-700');
                mediumBtn.classList.add('bg-gradient-to-r', 'from-yellow-600', 'to-yellow-700');
            });
            
            // Game mode tabs
            modeTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    setGameMode(mode);
                    
                    // Update active tab
                    modeTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Player name edit
            editNameBtn.addEventListener('click', function() {
                nameEditContainer.classList.remove('hidden');
                playerNameInput.value = playerName;
                playerNameInput.focus();
            });
            
            saveNameBtn.addEventListener('click', function() {
                const newName = playerNameInput.value.trim();
                if (newName) {
                    playerName = newName;
                    updatePlayerInfo();
                    nameEditContainer.classList.add('hidden');
                    saveGameData();
                }
            });
            
            // Add sparkle effect on hover for buttons
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('mouseover', createSparkle);
            });
        }
        
        function createCubes() {
            // Clear previous cubes
            cubesContainer.innerHTML = '';
            
            // Set grid columns based on number of cubes
            if (numCubes <= 3) {
                cubesContainer.className = 'grid grid-cols-3 gap-4 mb-6';
            } else if (numCubes <= 6) {
                cubesContainer.className = 'grid grid-cols-3 gap-4 mb-6';
            } else {
                cubesContainer.className = 'grid grid-cols-3 gap-3 mb-6';
            }
            
            // Create cubes
            for (let i = 0; i < numCubes; i++) {
                const scene = document.createElement('div');
                scene.className = 'scene';
                
                const cube = document.createElement('div');
                cube.className = 'cube';
                cube.id = `cube-${i}`;
                
                // Create cube faces
                allColors.forEach((color, index) => {
                    const face = document.createElement('div');
                    
                    // Determine which face this is
                    let faceClass;
                    switch (index) {
                        case 0: faceClass = 'front'; break;
                        case 1: faceClass = 'back'; break;
                        case 2: faceClass = 'right'; break;
                        case 3: faceClass = 'left'; break;
                        case 4: faceClass = 'top'; break;
                        case 5: faceClass = 'bottom'; break;
                    }
                    
                    face.className = `cube-face ${faceClass} ${color.bgClass}`;
                    
                    // Add hex code for Hex Master mode
                    if (currentGameMode === 'hex') {
                        face.textContent = color.hexCode;
                    }
                    
                    cube.appendChild(face);
                });
                
                scene.appendChild(cube);
                cubesContainer.appendChild(scene);
            }
        }
        
        function renderColorOptions() {
            // Clear previous options
            colorOptions.innerHTML = '';
            
            // Create color option elements
            allColors.forEach(color => {
                const colorOption = document.createElement('div');
                colorOption.className = `color-option ${color.bgClass}`;
                colorOption.setAttribute('data-color', color.name);
                
                // Add hex code display
                const hexCode = document.createElement('div');
                hexCode.className = 'hex-code';
                hexCode.textContent = color.hexCode;
                colorOption.appendChild(hexCode);
                
                // Add click event
                colorOption.addEventListener('click', function() {
                    selectColor(color.name, color.bgClass);
                });
                
                colorOptions.appendChild(colorOption);
            });
        }
        
        function selectColor(colorName, bgClass) {
            // Update selected color
            selectedColor = colorName;
            
            // Update visual display
            selectedColorDisplay.className = `w-6 h-6 rounded-full ${bgClass}`;
            
            // Update color options to show selection
            const options = document.querySelectorAll('.color-option');
            options.forEach(option => {
                if (option.getAttribute('data-color') === colorName) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }
        
        function setBetAmount(amount) {
            // Ensure bet doesn't exceed balance
            amount = Math.min(amount, playerBalance);
            
            // Update current bet
            currentBet = amount;
            betAmountDisplay.textContent = amount;
        }
        
        function setDifficulty(difficulty) {
            if (difficulty === 'easy') {
                numCubes = 3;
            } else if (difficulty === 'medium') {
                numCubes = 6;
            } else {
                numCubes = 9;
            }
            
            createCubes();
        }
        
        function setGameMode(mode) {
            currentGameMode = mode;
            
            // Update mode description
            switch(mode) {
                case 'classic':
                    modeDescription.textContent = 'Classic Mode: Bet on colors and win based on occurrences!';
                    break;
                case 'streak':
                    modeDescription.textContent = 'Streak Challenge: Win consecutive bets to increase your multiplier!';
                    break;
                case 'jackpot':
                    modeDescription.textContent = 'Jackpot Mode: Higher risk, higher reward with progressive jackpot!';
                    break;
                case 'hex':
                    modeDescription.textContent = 'Hex Master: Test your color knowledge by betting on hex codes!';
                    break;
            }
            
            // Recreate cubes for hex mode
            createCubes();
        }
        
        function rollCubes() {
            // Validate bet and color selection
            if (currentBet <= 0) {
                alert('Please place a bet first!');
                return;
            }
            
            if (!selectedColor) {
                alert('Please select a color first!');
                return;
            }
            
            if (gameInProgress) {
                return;
            }
            
            // Deduct bet from balance
            updateBalance(playerBalance - currentBet);
            
            // Start game
            gameInProgress = true;
            rollButton.disabled = true;
            resultMessage.textContent = '';
            
            // Add spinning animation to all cubes
            const cubes = document.querySelectorAll('.cube');
            cubes.forEach(cube => {
                cube.classList.add('spinning');
            });
            
            // Determine results after animation
            setTimeout(() => {
                determineResults();
            }, 1500);
        }
        
        function determineResults() {
            // Remove spinning animation from all cubes
            const cubes = document.querySelectorAll('.cube');
            cubes.forEach(cube => {
                cube.classList.remove('spinning');
            });
            
            // Generate random results for each cube
            const results = [];
            for (let i = 0; i < numCubes; i++) {
                const randomIndex = Math.floor(Math.random() * allColors.length);
                const resultColor = allColors[randomIndex].name;
                results.push(resultColor);
                
                // Apply rotation to show the result
                const cube = document.getElementById(`cube-${i}`);
                cube.style.transform = cubeRotations[resultColor];
            }
            
            // Count occurrences of the selected color
            const occurrences = results.filter(color => color === selectedColor).length;
            
            // Determine if player won and calculate winnings
            let winnings = 0;
            let multiplier = 1;
            
            if (occurrences > 0) {
                // Base multiplier from payout table
                multiplier = payoutMultipliers[occurrences] || 20;
                
                // Apply game mode specific modifiers
                if (currentGameMode === 'streak' && winStreak > 0) {
                    const streakMultiplier = streakMultipliers[Math.min(winStreak, 5)] || 1;
                    multiplier *= streakMultiplier;
                } else if (currentGameMode === 'jackpot') {
                    // Jackpot mode has higher risk/reward
                    if (Math.random() < 0.1) { // 10% chance of jackpot
                        multiplier *= 2;
                        resultMessage.textContent = `JACKPOT! Your color appeared ${occurrences} time${occurrences > 1 ? 's' : ''}!`;
                    }
                }
                
                winnings = Math.floor(currentBet * multiplier);
                
                // Update player stats
                updateBalance(playerBalance + winnings);
                winStreak++;
                totalWins++;
                
                // Update streak display with highlight animation
                streakDisplay.textContent = winStreak;
                streakDisplay.classList.add('highlight');
                setTimeout(() => {
                    streakDisplay.classList.remove('highlight');
                }, 1000);
                
                winsDisplay.textContent = totalWins;
                
                // Add XP based on difficulty and occurrences
                let xpGained = occurrences * 10;
                if (numCubes === 6) xpGained *= 1.5;
                if (numCubes === 9) xpGained *= 2;
                addPlayerXP(Math.floor(xpGained));
                
                // Display result message
                resultMessage.textContent = `Your color appeared ${occurrences} time${occurrences > 1 ? 's' : ''}! You won $${winnings}!`;
                resultMessage.className = 'text-xl font-bold h-8 mb-4 text-center text-green-400';
                
                // Create confetti effect
                createConfetti();
                
                // Check achievements
                checkAchievements(occurrences);
            } else {
                resultMessage.textContent = `Your color didn't appear. You lost $${currentBet}!`;
                resultMessage.className = 'text-xl font-bold h-8 mb-4 text-center text-red-400';
                winStreak = 0;
                streakDisplay.textContent = winStreak;
            }
            
            // Add to history
            addToHistory(selectedColor, occurrences, winnings);
            
            // Save game data
            saveGameData();
            
            // Reset game state
            setTimeout(() => {
                gameInProgress = false;
                rollButton.disabled = false;
            }, 1000);
        }
        
        function updateBalance(newBalance) {
            // Update balance with animation
            const oldBalance = playerBalance;
            playerBalance = newBalance;
            
            balanceDisplay.textContent = playerBalance;
            balanceDisplay.classList.add('balance-change');
            
            // Remove animation class after animation completes
            setTimeout(() => {
                balanceDisplay.classList.remove('balance-change');
            }, 500);
            
            // If balance is zero, show alert
            if (playerBalance <= 0) {
                setTimeout(() => {
                    alert('Game over! You ran out of money. Resetting balance to $1000.');
                    updateBalance(1000);
                }, 500);
            }
            
            // Check rich achievement
            if (playerBalance >= 5000 && !achievements.rich) {
                achievements.rich = true;
                document.getElementById('achievement2').classList.add('bg-gradient-to-br', 'from-yellow-400', 'to-yellow-600');
                alert('Achievement Unlocked: Rich! You reached $5000 balance.');
                saveGameData();
            }
        }
        
        function addToHistory(betColor, occurrences, winnings) {
            const row = document.createElement('tr');
            row.className = 'border-b border-indigo-800';
            
            // Determine outcome text and class
            let outcomeText, outcomeClass;
            if (occurrences > 0) {
                outcomeText = `+$${winnings}`;
                outcomeClass = 'text-green-400';
            } else {
                outcomeText = `-$${currentBet}`;
                outcomeClass = 'text-red-400';
            }
            
            // Get color class
            const colorClass = allColors.find(color => color.name === betColor)?.bgClass || 'bg-gray-500';
            
            // Create row content
            row.innerHTML = `
                <td class="px-4 py-2">${roundNumber}</td>
                <td class="px-4 py-2">
                    <span class="inline-block w-4 h-4 rounded-full ${colorClass} mr-2"></span>
                    ${betColor}
                </td>
                <td class="px-4 py-2">${occurrences}</td>
                <td class="px-4 py-2 text-right font-bold ${outcomeClass}">${outcomeText}</td>
            `;
            
            // Add to table
            historyTableBody.prepend(row);
            
            // Increment round number
            roundNumber++;
            
            // Limit history to 10 rows
            if (historyTableBody.children.length > 10) {
                historyTableBody.removeChild(historyTableBody.lastChild);
            }
        }
        
        function createConfetti() {
            // Create 50 confetti pieces
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                // Random position
                const left = Math.random() * 100;
                confetti.style.left = `${left}vw`;
                
                // Random color
                const colors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
                const colorIndex = Math.floor(Math.random() * colors.length);
                confetti.style.backgroundColor = colors[colorIndex];
                
                // Random size
                const size = Math.random() * 10 + 5;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                
                // Random rotation
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                // Random animation duration
                const duration = Math.random() * 2 + 2;
                confetti.style.animationDuration = `${duration}s`;
                
                // Add to body
                document.body.appendChild(confetti);
                
                // Remove after animation
                setTimeout(() => {
                    document.body.removeChild(confetti);
                }, duration * 1000);
            }
        }
        
        function updatePlayerInfo() {
            playerNameDisplay.textContent = playerName;
            playerInitial.textContent = playerName.charAt(0).toUpperCase();
            playerLevel.textContent = currentLevel;
            
            // Update level progress bar
            const nextLevelXP = levelXPRequirements[currentLevel] || 5000;
            const progressPercent = (playerXP / nextLevelXP) * 100;
            levelProgressFill.style.width = `${progressPercent}%`;
        }
        
        function addPlayerXP(xp) {
            playerXP += xp;
            
            // Check for level up
            const nextLevelXP = levelXPRequirements[currentLevel] || 5000;
            if (playerXP >= nextLevelXP && currentLevel < 5) {
                currentLevel++;
                playerXP = 0;
                alert(`Congratulations! You've reached Level ${currentLevel}!`);
            }
            
            updatePlayerInfo();
        }
        
        function checkAchievements(occurrences) {
            // First Win
            if (!achievements.firstWin && totalWins === 1) {
                achievements.firstWin = true;
                document.getElementById('achievement1').classList.add('bg-gradient-to-br', 'from-green-400', 'to-green-600');
                alert('Achievement Unlocked: First Win!');
            }
            
            // Hot Streak
            if (!achievements.hotStreak && winStreak >= 5) {
                achievements.hotStreak = true;
                document.getElementById('achievement3').classList.add('bg-gradient-to-br', 'from-orange-400', 'to-red-600');
                alert('Achievement Unlocked: Hot Streak! You won 5 times in a row!');
            }
            
            // Lucky (all cubes showing selected color)
            if (!achievements.lucky && occurrences === numCubes && numCubes >= 6) {
                achievements.lucky = true;
                document.getElementById('achievement4').classList.add('bg-gradient-to-br', 'from-pink-400', 'to-purple-600');
                alert('Achievement Unlocked: Lucky! All cubes showed your color!');
            }
            
            // Champion
            if (!achievements.champion && totalWins >= 50) {
                achievements.champion = true;
                document.getElementById('achievement5').classList.add('bg-gradient-to-br', 'from-blue-400', 'to-indigo-600');
                alert('Achievement Unlocked: Champion! You won 50 total bets!');
            }
            
            // Hex Master
            if (!achievements.hexMaster && currentGameMode === 'hex' && occurrences > 0) {
                achievements.hexMaster = true;
                document.getElementById('achievement6').classList.add('bg-gradient-to-br', 'from-indigo-400', 'to-purple-600');
                alert('Achievement Unlocked: Hex Master! You won in Hex Master mode!');
            }
        }
        
        function createSparkle(e) {
            // Create sparkle effect on hover
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            
            // Position at mouse location
            sparkle.style.left = `${e.offsetX}px`;
            sparkle.style.top = `${e.offsetY}px`;
            
            // Random color
            const colors = ['#fff', '#fcd34d', '#f87171', '#60a5fa', '#a78bfa'];
            const colorIndex = Math.floor(Math.random() * colors.length);
            sparkle.style.backgroundColor = colors[colorIndex];
            
            // Add to button
            this.appendChild(sparkle);
            
            // Animate
            sparkle.style.animation = 'sparkle 0.8s forwards';
            
            // Remove after animation
            setTimeout(() => {
                if (sparkle.parentNode === this) {
                    this.removeChild(sparkle);
                }
            }, 800);
        }
        
        function saveGameData() {
            const gameData = {
                playerName,
                playerBalance,
                totalWins,
                winStreak,
                playerXP,
                currentLevel,
                achievements
            };
            
            localStorage.setItem('carnivalColorCubesData', JSON.stringify(gameData));
        }
        
        function loadGameData() {
            const savedData = localStorage.getItem('carnivalColorCubesData');
            
            if (savedData) {
                const gameData = JSON.parse(savedData);
                
                playerName = gameData.playerName || "Player";
                playerBalance = gameData.playerBalance || 1000;
                totalWins = gameData.totalWins || 0;
                winStreak = gameData.winStreak || 0;
                playerXP = gameData.playerXP || 0;
                currentLevel = gameData.currentLevel || 1;
                achievements = gameData.achievements || {
                    firstWin: false,
                    rich: false,
                    hotStreak: false,
                    lucky: false,
                    champion: false,
                    hexMaster: false
                };
                
                // Update UI
                updateBalance(playerBalance);
                streakDisplay.textContent = winStreak;
                winsDisplay.textContent = totalWins;
                updatePlayerInfo();
                
                // Update achievement badges
                if (achievements.firstWin) {
                    document.getElementById('achievement1').classList.add('bg-gradient-to-br', 'from-green-400', 'to-green-600');
                }
                if (achievements.rich) {
                    document.getElementById('achievement2').classList.add('bg-gradient-to-br', 'from-yellow-400', 'to-yellow-600');
                }
                if (achievements.hotStreak) {
                    document.getElementById('achievement3').classList.add('bg-gradient-to-br', 'from-orange-400', 'to-red-600');
                }
                if (achievements.lucky) {
                    document.getElementById('achievement4').classList.add('bg-gradient-to-br', 'from-pink-400', 'to-purple-600');
                }
                if (achievements.champion) {
                    document.getElementById('achievement5').classList.add('bg-gradient-to-br', 'from-blue-400', 'to-indigo-600');
                }
                if (achievements.hexMaster) {
                    document.getElementById('achievement6').classList.add('bg-gradient-to-br', 'from-indigo-400', 'to-purple-600');
                }
            }
        }
        
        // Initialize with easy difficulty
        setDifficulty('easy');
    </script>
</body>
</html>